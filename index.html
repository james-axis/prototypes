<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axis CRM — Prototypes</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23ff4405' d='M0,12.8C0,8.32,0,6.08.87,4.37c.77-1.51,1.99-2.73,3.5-3.5C6.08,0,8.32,0,12.8,0h6.4C23.68,0,25.92,0,27.63.87c1.51.77,2.73,1.99,3.5,3.5.87,1.71.87,3.95.87,8.43v6.4c0,4.48,0,6.72-.87,8.43-.77,1.51-1.99,2.73-3.5,3.5-1.71.87-3.95.87-8.43.87h-6.4c-4.48,0-6.72,0-8.43-.87-1.51-.77-2.73-1.99-3.5-3.5C0,25.92,0,23.68,0,19.2v-6.4Z'/%3E%3Cpath fill='%23fff' d='M13.43,15.89l-9.43,10.27h4.86L28,5.35h-4.99l-7.08,7.63-7.08-7.63h-4.86l9.43,10.54Z'/%3E%3Cpath fill='%23fff' d='M23.01,26.16h4.99l-9.16-9.85c-1.44,2.37-.88,4.23-.42,4.86l4.58,4.99Z'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'axis-orange': '#D34108',
                        'axis-orange-light': '#EA6921',
                        'axis-slate': '#3B485B',
                        'axis-charcoal': '#2B3544',
                        'axis-gray': '#F5F5F5',
                    },
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes cardIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        .backdrop { animation: fadeIn 0.2s ease-out forwards; }
        .panel { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .card-anim { animation: cardIn 0.2s ease-out forwards; opacity: 0; }

        /* Card hover: faint orange border + warm glow — matches CRM pattern */
        .proto-card {
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }
        .proto-card:hover {
            border-color: rgba(211, 65, 8, 0.25);
            box-shadow: 0 0 0 3px rgba(211, 65, 8, 0.06), 0 1px 4px rgba(211, 65, 8, 0.05);
        }

        .scroll-area::-webkit-scrollbar { width: 3px; }
        .scroll-area::-webkit-scrollbar-track { background: transparent; }
        .scroll-area::-webkit-scrollbar-thumb { background: #E5E7EB; border-radius: 3px; }

        /* Archive button: always visible on touch, hover-only on desktop */
        @media (hover: none) {
            .archive-btn { opacity: 1 !important; }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-200/60">

    <!-- Backdrop -->
    <div class="backdrop fixed inset-0 bg-black/20 z-40"></div>

    <!-- Panel -->
    <div class="panel fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl shadow-[0_20px_60px_-15px_rgba(0,0,0,0.2)] w-full sm:max-w-[420px] max-h-[90vh] sm:max-h-none overflow-hidden">

            <!-- Header -->
            <div class="px-5 pt-5 pb-3">
                <div class="flex items-start justify-between">
                    <div class="flex items-center gap-3">
                        <!-- Axis logo SVG inline -->
                        <svg class="w-9 h-9 flex-shrink-0" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                            <path fill="#ff4405" d="M0,12.8C0,8.32,0,6.08.87,4.37c.77-1.51,1.99-2.73,3.5-3.5C6.08,0,8.32,0,12.8,0h6.4C23.68,0,25.92,0,27.63.87c1.51.77,2.73,1.99,3.5,3.5.87,1.71.87,3.95.87,8.43v6.4c0,4.48,0,6.72-.87,8.43-.77,1.51-1.99,2.73-3.5,3.5-1.71.87-3.95.87-8.43.87h-6.4c-4.48,0-6.72,0-8.43-.87-1.51-.77-2.73-1.99-3.5-3.5C0,25.92,0,23.68,0,19.2v-6.4Z"/>
                            <path fill="#fff" d="M13.43,15.89l-9.43,10.27h4.86L28,5.35h-4.99l-7.08,7.63-7.08-7.63h-4.86l9.43,10.54Z"/>
                            <path fill="#fff" d="M23.01,26.16h4.99l-9.16-9.85c-1.44,2.37-.88,4.23-.42,4.86l4.58,4.99Z"/>
                        </svg>
                        <div>
                            <h1 class="text-[17px] font-bold text-axis-charcoal leading-tight">Prototypes</h1>
                            <p id="subtitle" class="text-[12px] text-gray-400 mt-0.5">Loading...</p>
                        </div>
                    </div>
                    <a href="https://axiscrm.atlassian.net/jira/polaris/projects/AR/ideas" target="_blank" class="mt-1 text-[11px] text-gray-400 hover:text-axis-orange transition-colors font-medium">
                        Roadmap →
                    </a>
                </div>
            </div>

            <!-- Tabs -->
            <div class="mx-5 flex items-center justify-between border-b border-gray-100">
                <div class="flex items-center gap-0">
                    <button id="tab-all" onclick="setFilter('all')" class="tab-btn relative px-3 pb-2 text-[13px] font-semibold text-axis-orange">
                        Active <span id="count-all" class="ml-0.5 text-[11px] font-medium text-axis-orange">0</span>
                        <div class="tab-bar absolute bottom-0 left-0 right-0 h-[2px] bg-axis-orange rounded-full"></div>
                    </button>
                    <button id="tab-archived" onclick="setFilter('archived')" class="tab-btn relative px-3 pb-2 text-[13px] font-medium text-gray-400 hover:text-gray-500">
                        Archived <span id="count-archived" class="ml-0.5 text-[11px] font-medium text-gray-400">0</span>
                    </button>
                </div>
                <button onclick="toggleSort()" class="flex items-center gap-1 pb-2 text-[12px] font-medium text-gray-400 hover:text-gray-600 transition-colors">
                    <svg id="sort-arrow" class="w-3 h-3 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l4-4 4 4M16 15l-4 4-4-4" />
                    </svg>
                    <span id="sort-text">Newest first</span>
                </button>
            </div>

            <!-- Card list -->
            <div id="list" class="scroll-area max-h-[55vh] sm:max-h-[400px] overflow-y-auto py-3 px-3">

                <!-- Loading -->
                <div id="state-loading" class="py-16 text-center">
                    <svg class="w-5 h-5 animate-spin text-axis-orange/40 mx-auto mb-2.5" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    <p class="text-[13px] text-gray-400">Loading prototypes…</p>
                </div>

                <!-- Empty -->
                <div id="state-empty" class="py-16 text-center hidden">
                    <svg class="w-10 h-10 text-gray-200 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <p id="empty-label" class="text-[13px] font-medium text-gray-400">No prototypes yet</p>
                    <p id="empty-hint" class="text-[11px] text-gray-300 mt-1">Send /idea in Telegram to get started</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="px-5 py-3 border-t border-gray-100 flex items-center justify-between">
                <span class="text-[11px] text-gray-300">Auto-generated by PM Agent</span>
                <span class="text-[11px] text-gray-300">james-axis.github.io/prototypes</span>
            </div>
        </div>
    </div>

    <script>
    const REPO = 'james-axis/prototypes';
    const PAGES = 'https://james-axis.github.io/prototypes';
    const ARCHIVE_KEY = 'axis-prototypes-archived';
    let protos = [];
    let newestFirst = true;
    let filter = 'all';

    function getArchived() {
        try { return JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]'); } catch { return []; }
    }
    function setArchived(keys) {
        localStorage.setItem(ARCHIVE_KEY, JSON.stringify(keys));
    }
    function archiveItem(key) {
        const a = getArchived();
        if (!a.includes(key)) { a.push(key); setArchived(a); }
        render();
    }
    function unarchiveItem(key) {
        setArchived(getArchived().filter(k => k !== key));
        render();
    }

    async function load() {
        try {
            const r = await fetch('https://api.github.com/repos/' + REPO + '/contents/', {
                headers: { 'Accept': 'application/vnd.github+json' }
            });
            if (!r.ok) throw new Error(r.status);
            const files = await r.json();
            const htmls = files.filter(f => f.name.endsWith('.html') && f.name !== 'index.html');

            if (!htmls.length) {
                document.getElementById('state-loading').classList.add('hidden');
                document.getElementById('state-empty').classList.remove('hidden');
                document.getElementById('subtitle').textContent = '0 prototypes';
                return;
            }

            protos = await Promise.all(htmls.map(async f => {
                const key = f.name.replace('.html', '');
                let date = null, summary = key, commitMsg = '';
                try {
                    const cr = await fetch(
                        'https://api.github.com/repos/' + REPO + '/commits?path=' + f.name + '&per_page=1',
                        { headers: { 'Accept': 'application/vnd.github+json' } }
                    );
                    if (cr.ok) {
                        const commits = await cr.json();
                        if (commits.length) {
                            date = new Date(commits[0].commit.author.date);
                            commitMsg = commits[0].commit.message || '';
                            const m = commitMsg.match(/(?:Prototype for|Update prototype:)\s*\S+:\s*(.*)/i);
                            if (m) summary = m[1].trim();
                        }
                    }
                } catch(e) {}
                const isUpdate = commitMsg.toLowerCase().startsWith('update');
                return { key, summary, date, url: PAGES + '/' + f.name, size: f.size, isUpdate };
            }));

            render();
        } catch(e) {
            console.error(e);
            document.getElementById('state-loading').classList.add('hidden');
            document.getElementById('state-empty').classList.remove('hidden');
            document.getElementById('subtitle').textContent = '0 prototypes';
        }
    }

    function render() {
        const list = document.getElementById('list');
        document.getElementById('state-loading').classList.add('hidden');
        list.querySelectorAll('.proto-card').forEach(el => el.remove());

        const archived = getArchived();
        const isArchivedTab = filter === 'archived';

        let items = [...protos];
        if (isArchivedTab) {
            items = items.filter(p => archived.includes(p.key));
        } else {
            items = items.filter(p => !archived.includes(p.key));
        }

        items.sort((a, b) => {
            if (!a.date) return 1;
            if (!b.date) return -1;
            return newestFirst ? b.date - a.date : a.date - b.date;
        });

        const activeCount = protos.filter(p => !archived.includes(p.key)).length;
        const archivedCount = protos.filter(p => archived.includes(p.key)).length;
        document.getElementById('count-all').textContent = activeCount;
        document.getElementById('count-archived').textContent = archivedCount;
        document.getElementById('subtitle').textContent = activeCount + ' active, ' + archivedCount + ' archived';

        // Update archived count color to match tab state
        document.getElementById('count-archived').className = 'ml-0.5 text-[11px] font-medium ' +
            (isArchivedTab ? 'text-axis-orange' : 'text-gray-400');
        document.getElementById('count-all').className = 'ml-0.5 text-[11px] font-medium ' +
            (filter === 'all' ? 'text-axis-orange' : 'text-gray-400');

        if (!items.length) {
            document.getElementById('state-empty').classList.remove('hidden');
            const emptyLabel = document.getElementById('empty-label');
            const emptyHint = document.getElementById('empty-hint');
            if (isArchivedTab) {
                emptyLabel.textContent = 'No archived prototypes';
                emptyHint.textContent = 'Archive items from the Active tab';
            } else {
                emptyLabel.textContent = 'No prototypes yet';
                emptyHint.textContent = 'Send /idea in Telegram to get started';
            }
            return;
        }
        document.getElementById('state-empty').classList.add('hidden');

        items.forEach((p, i) => {
            const days = p.date ? Math.floor((Date.now() - p.date) / 86400000) : null;
            const dateStr = !p.date ? '' :
                p.date.toLocaleDateString('en-AU', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const isRecent = days !== null && days <= 7;

            const card = document.createElement('div');
            card.className = 'proto-card card-anim block p-4 mb-2 bg-white';
            card.style.animationDelay = (i * 0.04) + 's';

            const archiveBtn = isArchivedTab
                ? `<button onclick="event.stopPropagation();unarchiveItem('${p.key}')" class="archive-btn opacity-0 group-hover:opacity-100 p-1.5 rounded-lg hover:bg-axis-orange/10 transition-all" title="Restore">
                     <svg class="w-4 h-4 text-axis-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                       <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"/>
                     </svg>
                   </button>`
                : `<button onclick="event.stopPropagation();archiveItem('${p.key}')" class="archive-btn opacity-0 group-hover:opacity-100 p-1.5 rounded-lg hover:bg-gray-100 transition-all" title="Archive">
                     <svg class="w-4 h-4 text-gray-400 hover:text-axis-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                       <path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0-3-3m3 3 3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"/>
                     </svg>
                   </button>`;

            card.innerHTML = `
                <div class="group cursor-pointer" onclick="window.open('${p.url}','_blank')">
                    <div class="flex items-start justify-between gap-3">
                        <span class="text-[15px] font-semibold ${isArchivedTab ? 'text-gray-400' : 'text-axis-orange'} leading-tight">${p.key}</span>
                        <div class="flex items-center gap-2">
                            ${archiveBtn}
                            <span class="inline-flex items-center gap-1.5 text-[12px] text-gray-400 flex-shrink-0">
                                <span class="w-[7px] h-[7px] rounded-full ${isRecent && !isArchivedTab ? 'bg-axis-orange' : 'bg-gray-300'}"></span>
                                ${dateStr}
                            </span>
                        </div>
                    </div>

                    <div class="mt-2">
                        <p class="text-[13px] ${isArchivedTab ? 'text-gray-400' : 'text-axis-charcoal/70'} leading-snug">${p.summary}</p>
                    </div>

                    <div class="flex items-center gap-3 mt-3">
                        ${isArchivedTab
                            ? '<span class="inline-block text-[11px] font-medium px-2 py-[3px] rounded-md bg-gray-100 text-gray-400">Archived</span>'
                            : `<span class="inline-block text-[11px] font-medium px-2 py-[3px] rounded-md ${isRecent ? 'bg-axis-orange/10 text-axis-orange' : 'bg-gray-100 text-gray-400'}">
                                ${isRecent ? 'New' : 'Prototype'}
                              </span>
                              ${p.isUpdate ? '<span class="inline-block text-[11px] font-medium px-2 py-[3px] rounded-md bg-blue-50 text-blue-400">Updated</span>' : ''}`
                        }
                        <span class="ml-auto text-[11px] text-gray-300">${p.size ? Math.round(p.size / 1024) + 'KB' : ''}</span>
                    </div>
                </div>
            `;
            list.appendChild(card);
        });
    }

    function setFilter(f) {
        filter = f;
        document.querySelectorAll('.tab-btn').forEach(btn => {
            const id = btn.id;
            const isActive = id === 'tab-' + f;
            btn.className = 'tab-btn relative px-3 pb-2 text-[13px] ' +
                (isActive ? 'font-semibold text-axis-orange' : 'font-medium text-gray-400 hover:text-gray-500');
            const bar = btn.querySelector('.tab-bar');
            if (bar) bar.remove();
            if (isActive) {
                const d = document.createElement('div');
                d.className = 'tab-bar absolute bottom-0 left-0 right-0 h-[2px] bg-axis-orange rounded-full';
                btn.appendChild(d);
            }
        });
        render();
    }

    function toggleSort() {
        newestFirst = !newestFirst;
        document.getElementById('sort-text').textContent = newestFirst ? 'Newest first' : 'Oldest first';
        render();
    }

    load();
    </script>
</body>
</html>
