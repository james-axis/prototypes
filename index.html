<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axis CRM — Prototypes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'axis-orange': '#D34108',
                        'axis-orange-light': '#EA6921',
                        'axis-slate': '#3B485B',
                        'axis-charcoal': '#2B3544',
                        'axis-gray': '#F5F5F5',
                    },
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes cardIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .backdrop { animation: fadeIn 0.25s ease-out forwards; }
        .modal { animation: slideUp 0.35s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .card-anim { animation: cardIn 0.25s ease-out forwards; opacity: 0; }
        .card-item { transition: all 0.12s ease; }
        .card-item:hover { background: #FAFAFA; }
        .card-item:active { transform: scale(0.995); }
        .scroll-area::-webkit-scrollbar { width: 3px; }
        .scroll-area::-webkit-scrollbar-track { background: transparent; }
        .scroll-area::-webkit-scrollbar-thumb { background: #E5E7EB; border-radius: 3px; }
        .scroll-area::-webkit-scrollbar-thumb:hover { background: #D1D5DB; }
    </style>
</head>
<body class="min-h-screen bg-gray-100/80">

    <!-- Backdrop -->
    <div class="backdrop fixed inset-0 bg-axis-charcoal/30 backdrop-blur-[2px] z-40"></div>

    <!-- Modal -->
    <div class="modal fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-[0_25px_60px_-12px_rgba(0,0,0,0.15)] w-full max-w-[440px] overflow-hidden">

            <!-- Icon + Header -->
            <div class="pt-7 pb-4 px-6 text-center">
                <div class="w-16 h-16 rounded-full bg-axis-orange/8 flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-axis-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </div>
                <h1 class="text-[19px] font-bold text-axis-charcoal">Prototypes</h1>
                <p class="text-[13px] text-gray-400 mt-1">Select an interactive prototype to preview</p>
            </div>

            <!-- Tabs + Sort row -->
            <div class="mx-6 flex items-center justify-between border-b border-gray-100">
                <div class="flex items-center">
                    <button id="tab-all" onclick="setFilter('all')" class="tab-btn relative px-3 pb-2.5 text-[13px] font-semibold text-axis-orange">
                        All <span id="count-all" class="ml-0.5 text-[11px] bg-axis-orange/10 text-axis-orange px-1.5 py-[1px] rounded-full font-medium">0</span>
                        <div class="absolute bottom-0 left-0 right-0 h-[2px] bg-axis-orange rounded-full"></div>
                    </button>
                    <button id="tab-month" onclick="setFilter('month')" class="tab-btn relative px-3 pb-2.5 text-[13px] font-medium text-gray-400 hover:text-gray-500 ml-1">
                        This month
                    </button>
                </div>
                <button onclick="toggleSort()" class="flex items-center gap-1 pb-2.5 text-[11px] font-medium text-gray-400 hover:text-gray-600 transition-colors">
                    <svg id="sort-arrow" class="w-3 h-3 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                    <span id="sort-text">Newest first</span>
                </button>
            </div>

            <!-- Cards list -->
            <div id="list" class="scroll-area max-h-[370px] overflow-y-auto py-2 px-3">

                <!-- Loading -->
                <div id="state-loading" class="py-14 text-center">
                    <svg class="w-5 h-5 animate-spin text-gray-300 mx-auto mb-2" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    <p class="text-[13px] text-gray-400">Loading prototypes…</p>
                </div>

                <!-- Empty -->
                <div id="state-empty" class="py-14 text-center hidden">
                    <div class="w-11 h-11 rounded-full bg-gray-50 flex items-center justify-center mx-auto mb-3">
                        <svg class="w-5 h-5 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                        </svg>
                    </div>
                    <p class="text-[13px] font-medium text-gray-400">No prototypes yet</p>
                    <p class="text-[11px] text-gray-300 mt-1">Send /idea in Telegram to get started</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 border-t border-gray-100 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="w-5 h-5 rounded bg-axis-orange flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-[8px] font-bold tracking-tight leading-none">AX</span>
                    </div>
                    <span class="text-[11px] text-gray-400">Axis CRM · PM Agent</span>
                </div>
                <a href="https://axiscrm.atlassian.net/jira/polaris/projects/AR/ideas" target="_blank" class="text-[11px] text-axis-orange hover:text-axis-orange-light font-medium transition-colors">
                    View Roadmap →
                </a>
            </div>
        </div>
    </div>

    <script>
    const REPO = 'james-axis/prototypes';
    const PAGES = 'https://james-axis.github.io/prototypes';
    let protos = [];
    let newestFirst = true;
    let filter = 'all';

    async function load() {
        try {
            const r = await fetch('https://api.github.com/repos/' + REPO + '/contents/', {
                headers: { 'Accept': 'application/vnd.github+json' }
            });
            if (!r.ok) throw new Error(r.status);
            const files = await r.json();
            const htmls = files.filter(f => f.name.endsWith('.html') && f.name !== 'index.html');

            if (!htmls.length) {
                document.getElementById('state-loading').classList.add('hidden');
                document.getElementById('state-empty').classList.remove('hidden');
                return;
            }

            protos = await Promise.all(htmls.map(async f => {
                const key = f.name.replace('.html', '');
                let date = null, summary = key;
                try {
                    const cr = await fetch(
                        'https://api.github.com/repos/' + REPO + '/commits?path=' + f.name + '&per_page=1',
                        { headers: { 'Accept': 'application/vnd.github+json' } }
                    );
                    if (cr.ok) {
                        const commits = await cr.json();
                        if (commits.length) {
                            date = new Date(commits[0].commit.author.date);
                            const msg = commits[0].commit.message || '';
                            const m = msg.match(/(?:Prototype for|Update prototype:)\s*\S+:\s*(.*)/i);
                            if (m) summary = m[1].trim();
                        }
                    }
                } catch(e) {}
                return { key, summary, date, url: PAGES + '/' + f.name, size: f.size };
            }));

            render();
        } catch(e) {
            console.error(e);
            document.getElementById('state-loading').classList.add('hidden');
            document.getElementById('state-empty').classList.remove('hidden');
        }
    }

    function render() {
        const list = document.getElementById('list');
        document.getElementById('state-loading').classList.add('hidden');
        list.querySelectorAll('.proto-card').forEach(el => el.remove());

        let items = [...protos];
        if (filter === 'month') {
            const start = new Date(); start.setDate(1); start.setHours(0,0,0,0);
            items = items.filter(p => p.date && p.date >= start);
        }

        items.sort((a, b) => {
            if (!a.date) return 1;
            if (!b.date) return -1;
            return newestFirst ? b.date - a.date : a.date - b.date;
        });

        document.getElementById('count-all').textContent = protos.length;

        if (!items.length) {
            document.getElementById('state-empty').classList.remove('hidden');
            return;
        }
        document.getElementById('state-empty').classList.add('hidden');

        items.forEach((p, i) => {
            const days = p.date ? Math.floor((Date.now() - p.date) / 86400000) : null;
            const dateLabel = !p.date ? '' : days === 0 ? 'Today' : days === 1 ? 'Yesterday' : days < 7 ? days + 'd ago' : p.date.toLocaleDateString('en-AU', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const isNew = days !== null && days <= 2;
            const kb = p.size ? Math.round(p.size / 1024) + 'KB' : '';

            const card = document.createElement('a');
            card.href = p.url;
            card.className = 'proto-card card-item card-anim block rounded-xl p-4 mb-1 cursor-pointer border border-transparent hover:border-gray-100';
            card.style.animationDelay = (i * 0.04) + 's';

            card.innerHTML = `
                <div class="flex items-start justify-between gap-3">
                    <div class="min-w-0 flex-1">
                        <div class="flex items-center gap-2">
                            <span class="text-[15px] font-semibold text-axis-orange">${p.key}</span>
                            ${isNew ? '<span class="text-[10px] font-medium text-axis-orange bg-axis-orange/8 px-1.5 py-[2px] rounded-full leading-none">New</span>' : ''}
                        </div>
                        <p class="text-[13px] text-axis-charcoal/80 mt-0.5 truncate">${p.summary}</p>
                    </div>
                    <div class="flex-shrink-0 flex flex-col items-end pt-0.5">
                        <span class="inline-flex items-center gap-1.5 text-[12px] text-gray-400">
                            <span class="w-[6px] h-[6px] rounded-full ${days !== null && days <= 7 ? 'bg-axis-orange' : 'bg-gray-300'}"></span>
                            ${dateLabel}
                        </span>
                    </div>
                </div>
                <div class="flex items-center gap-4 mt-3 pt-2.5 border-t border-gray-50">
                    <span class="text-[11px] text-gray-400 flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                        Interactive
                    </span>
                    ${kb ? '<span class="text-[11px] text-gray-300">' + kb + '</span>' : ''}
                    <span onclick="event.preventDefault();event.stopPropagation();window.open('https://axiscrm.atlassian.net/browse/' + '${p.key}', '_blank')" class="text-[11px] text-axis-slate hover:text-axis-orange font-medium transition-colors cursor-pointer flex items-center gap-1 ml-auto">
                        Jira
                        <svg class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                    </span>
                </div>
            `;
            list.appendChild(card);
        });
    }

    function setFilter(f) {
        filter = f;
        document.querySelectorAll('.tab-btn').forEach(btn => {
            const isActive = btn.id === 'tab-' + f;
            btn.className = 'tab-btn relative px-3 pb-2.5 text-[13px] font-' + (isActive ? 'semibold' : 'medium') + ' text-' + (isActive ? 'axis-orange' : 'gray-400 hover:text-gray-500') + (f !== 'all' ? ' ml-1' : '');
            const bar = btn.querySelector('div');
            if (bar) bar.remove();
            if (isActive) {
                const d = document.createElement('div');
                d.className = 'absolute bottom-0 left-0 right-0 h-[2px] bg-axis-orange rounded-full';
                btn.appendChild(d);
            }
        });
        render();
    }

    function toggleSort() {
        newestFirst = !newestFirst;
        document.getElementById('sort-text').textContent = newestFirst ? 'Newest first' : 'Oldest first';
        document.getElementById('sort-arrow').style.transform = newestFirst ? '' : 'rotate(180deg)';
        render();
    }

    load();
    </script>
</body>
</html>
